#!/usr/bin/env zsh
# vim:autoindent:expandtab:ts=4


dotfiles=(.aliases.csh .bcrc .gitconfig .gitconfig-rightside .ircrc .iterm2_shell_integration.zsh .login_conf .pypirc .screenrc .tcshrc .vimrc .xvimrc .zprofile .zshenv .zshrc)
pushd `dirname $0` > /dev/null
linkdir=`pwd -L`
popd > /dev/null

for file in $dotfiles; do
    ln -fs $linkdir/$file ~/$file
done

# secure files
# Some files can't be symlinks.. copy them
dotfiles=(.login_conf)
pushd `dirname $0` > /dev/null
linkdir=`pwd -L`
popd > /dev/null

for file in $dotfiles; do
    cp -f $linkdir/$file ~/$file
done

vimsrcdirs=(`find ${linkdir}/.vim  -type d`)
vimdestdirs=(`echo $vimsrcdirs | sed "s|${linkdir}/*||g"`)
for dir in $vimdestdirs; do
    if [[ ! -d ~/$dir ]]; then
        mkdir -p ~/${dir}
    fi
done

vimfiles=(`find $vimsrcdirs -maxdepth 1 -mindepth 1 -type f`)
for src in $vimfiles; do
    dest=`echo $src | sed "s|${linkdir}/*||g"`
    if [[ ! -f ~/$dest ]]; then
        ln -s $src ~/$dest
    fi
done

cfgsrcdirs=(`find ${linkdir}/.config -type d`)
cfgdestdirs=(`echo $cfgsrcdirs | sed "s|${linkdir}/*||g"`)
for dir in $cfgdestdirs; do
    if [[ ! -d ~/$dir ]]; then
        mkdir -p ~/${dir}
    fi
done

cfgfiles=(`find $cfgsrcdirs -maxdepth 1 -mindepth 1 -type f`)
for src in $cfgfiles; do
    dest=`echo $src | sed "s|${linkdir}/*||g"`
    if [[ ! -f ~/$dest ]]; then
        ln -s $src ~/$dest
    fi
done

ircsrcdirs=(`find ${linkdir}/.irc -type d`)
ircdestdirs=(`echo $ircsrcdirs | sed "s|${linkdir}/*||g"`)
for dir in $ircdestdirs; do
    if [[ ! -d ~/$dir ]]; then
        mkdir -p ~/${dir}
    fi
done

ircfiles=(`find $ircsrcdirs -maxdepth 1 -mindepth 1 -type f`)
for src in $ircfiles; do
    dest=`echo $src | sed "s|${linkdir}/*||g"`
    if [[ ! -f ~/$dest ]]; then
        ln -s $src ~/$dest
    fi
done

ipython=`which ipython` >& /dev/null
if [[ -x $ipython && ! -d ~/.ipython ]]; then
    ${ipython} profile create
fi
if [[ -x $ipython ]]; then 
    if [[ -f ~/.ipython/profile_default/ipython_config.py ]]; then
        rm ~/.ipython/profile_default/ipython_config.py 
    fi
    if [[ ! -h ~/.ipython/profile_default/ipython_config.py ]]; then
        ln -fs $linkdir/ipython_config.py ~/.ipython/profile_default/ipython_config.py
    fi
fi

